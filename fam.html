<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>لوحة التحكم - منصة إدارة شؤون العائلة</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #4e73df;
            --secondary: #6f42c1;
            --success: #1cc88a;
            --info: #36b9cc;
            --warning: #f6c23e;
            --danger: #e74a3b;
            --light: #f8f9fc;
            --dark: #5a5c69;
        }
        
        * {
            font-family: 'Cairo', sans-serif;
        }
        
        body {
            background-color: #f8f9fc;
            color: #444;
            padding-top: 60px;
        }
        
        .navbar {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        .sidebar {
            background: linear-gradient(180deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            height: 100vh;
            position: fixed;
            top: 0;
            right: 0;
            padding-top: 60px;
            width: 250px;
            box-shadow: 3px 0 10px rgba(0, 0, 0, 0.1);
            transition: all 0.3s;
            z-index: 1000;
            overflow-y: auto;
        }
        
        .sidebar .nav-link {
            color: rgba(255, 255, 255, 0.8);
            padding: 15px 20px;
            margin: 5px 0;
            border-radius: 5px;
            transition: all 0.3s;
        }
        
        .sidebar .nav-link:hover {
            color: white;
            background: rgba(255, 255, 255, 0.1);
        }
        
        .sidebar .nav-link.active {
            color: white;
            background: rgba(255, 255, 255, 0.2);
        }
        
        .sidebar .nav-link i {
            margin-left: 10px;
        }
        
        .main-content {
            margin-right: 250px;
            padding: 20px;
            transition: all 0.3s;
        }
        
        .dashboard-card {
            border-left: 4px solid var(--primary);
            border-radius: 8px;
            transition: all 0.3s;
        }
        
        .dashboard-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }
        
        .card-calendar {
            border-left: 4px solid var(--success);
        }
        
        .card-expenses {
            border-left: 4px solid var(--info);
        }
        
        .card-notes {
            border-left: 4px solid var(--warning);
        }
        
        .stat-number {
            font-size: 2rem;
            font-weight: 700;
        }
        
        .family-img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid white;
        }
        
        .family-event {
            border-right: 3px solid var(--primary);
            background-color: rgba(78, 115, 223, 0.1);
        }
        
        .expense-item {
            border-bottom: 1px solid #eee;
            padding: 10px 0;
        }
        
        .progress {
            height: 10px;
            border-radius: 5px;
        }
        
        .btn-primary {
            background-color: var(--primary);
            border-color: var(--primary);
        }
        
        .btn-primary:hover {
            background-color: #3a5fc8;
            border-color: #3a5fc8;
        }
        
        .section-title {
            position: relative;
            padding-bottom: 15px;
            margin-bottom: 30px;
            border-bottom: 2px solid #eee;
        }
        
        .action-buttons {
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .list-group-item:hover .action-buttons,
        .expense-item:hover .action-buttons,
        .d-flex.mb-4:hover .action-buttons {
            opacity: 1;
        }
        
        .btn-icon {
            padding: 0.25rem 0.5rem;
            font-size: 0.875rem;
        }
        
        @media (max-width: 768px) {
            .sidebar {
                width: 80px;
                text-align: center;
            }
            
            .sidebar .nav-link span {
                display: none;
            }
            
            .sidebar .nav-link i {
                margin: 0;
                font-size: 1.5rem;
            }
            
            .main-content {
                margin-right: 80px;
            }
            
            .action-buttons {
                opacity: 1; /* إظهار أزرار الإجراءات على الجوال */
            }
        }
    </style>
</head>
<body>
    <!-- شريط التنقل -->
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
        <div class="container-fluid">
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <a class="navbar-brand" href="#">
                <i class="fas fa-home me-2"></i>
                منصة إدارة شؤون العائلة
            </a>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown">
                            <img src="https://ui-avatars.com/api/?name=الأب&background=4e73df&color=fff" class="family-img me-2">
                            الأب
                        </a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="#">الملف الشخصي</a></li>
                            <li><a class="dropdown-item" href="#">الإعدادات</a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item" href="#">تسجيل الخروج</a></li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- الشريط الجانبي -->
    <div class="sidebar">
        <ul class="nav flex-column">
            <li class="nav-item">
                <a class="nav-link active" href="dashboard.html">
                    <i class="fas fa-home"></i>
                    <span>لوحة التحكم</span>
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="calendar.html">
                    <i class="fas fa-calendar-alt"></i>
                    <span>التقويم العائلي</span>
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="expenses.html">
                    <i class="fas fa-money-bill-wave"></i>
                    <span>إدارة المصروفات</span>
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="notes.html">
                    <i class="fas fa-sticky-note"></i>
                    <span>ملاحظات العائلة</span>
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="members.html">
                    <i class="fas fa-users"></i>
                    <span>أفراد العائلة</span>
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="reports.html">
                    <i class="fas fa-chart-pie"></i>
                    <span>التقارير</span>
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="settings.html">
                    <i class="fas fa-cog"></i>
                    <span>الإعدادات</span>
                </a>
            </li>
        </ul>
    </div>

    <!-- المحتوى الرئيسي -->
    <div class="main-content">
        <div class="container-fluid">
            <!-- إحصائيات سريعة -->
            <div class="row mb-4">
                <div class="col-12">
                    <h2 class="section-title">لوحة تحكم العائلة</h2>
                </div>
                <div class="col-xl-3 col-md-6 mb-4">
                    <div class="card dashboard-card h-100">
                        <div class="card-body">
                            <div class="row align-items-center">
                                <div class="col">
                                    <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">أحداث هذا الشهر</div>
                                    <div class="h5 mb-0 font-weight-bold text-gray-800" id="events-count">8 أحداث</div>
                                </div>
                                <div class="col-auto">
                                    <i class="fas fa-calendar-alt fa-2x text-gray-300"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-xl-3 col-md-6 mb-4">
                    <div class="card dashboard-card h-100">
                        <div class="card-body">
                            <div class="row align-items-center">
                                <div class="col">
                                    <div class="text-xs font-weight-bold text-success text-uppercase mb-1">المصروفات الشهرية</div>
                                    <div class="h5 mb-0 font-weight-bold text-gray-800" id="expenses-total">2,450 ريال</div>
                                </div>
                                <div class="col-auto">
                                    <i class="fas fa-money-bill-wave fa-2x text-gray-300"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-xl-3 col-md-6 mb-4">
                    <div class="card dashboard-card h-100">
                        <div class="card-body">
                            <div class="row align-items-center">
                                <div class="col">
                                    <div class="text-xs font-weight-bold text-info text-uppercase mb-1">أفراد العائلة</div>
                                    <div class="h5 mb-0 font-weight-bold text-gray-800" id="members-count">5 أفراد</div>
                                </div>
                                <div class="col-auto">
                                    <i class="fas fa-users fa-2x text-gray-300"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-xl-3 col-md-6 mb-4">
                    <div class="card dashboard-card h-100">
                        <div class="card-body">
                            <div class="row align-items-center">
                                <div class="col">
                                    <div class="text-xs font-weight-bold text-warning text-uppercase mb-1">ملاحظات نشطة</div>
                                    <div class="h5 mb-0 font-weight-bold text-gray-800" id="notes-count">12 ملاحظة</div>
                                </div>
                                <div class="col-auto">
                                    <i class="fas fa-sticky-note fa-2x text-gray-300"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- المحتوى الرئيسي -->
            <div class="row">
                <!-- التقويم العائلي -->
                <div class="col-lg-6 mb-4">
                    <div class="card shadow h-100">
                        <div class="card-header py-3 d-flex justify-content-between align-items-center">
                            <h6 class="m-0 font-weight-bold text-primary">التقويم العائلي - الأحداث القادمة</h6>
                            <div>
                                <button class="btn btn-sm btn-primary me-2" data-bs-toggle="modal" data-bs-target="#addEventModal">
                                    <i class="fas fa-plus"></i>
                                </button>
                                <a href="calendar.html" class="btn btn-sm btn-primary">عرض الكل</a>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="list-group" id="upcoming-events">
                                <!-- سيتم ملء المحتوى ديناميكيًا -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- إدارة المصروفات -->
                <div class="col-lg-6 mb-4">
                    <div class="card shadow h-100">
                        <div class="card-header py-3 d-flex justify-content-between align-items-center">
                            <h6 class="m-0 font-weight-bold text-primary">إدارة المصروفات - ملخص الشهر</h6>
                            <div>
                                <button class="btn btn-sm btn-primary me-2" data-bs-toggle="modal" data-bs-target="#addExpenseModal">
                                    <i class="fas fa-plus"></i>
                                </button>
                                <a href="expenses.html" class="btn btn-sm btn-primary">عرض الكل</a>
                            </div>
                        </div>
                        <div class="card-body">
                            <h6 class="font-weight-bold">ميزانية الشهر الحالي</h6>
                            <div class="progress mb-4">
                                <div class="progress-bar bg-success" role="progressbar" style="width: 65%" id="budget-progress"></div>
                            </div>
                            
                            <div id="expenses-list">
                                <!-- سيتم ملء المحتوى ديناميكيًا -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ملاحظات العائلة -->
                <div class="col-lg-6 mb-4">
                    <div class="card shadow h-100">
                        <div class="card-header py-3 d-flex justify-content-between align-items-center">
                            <h6 class="m-0 font-weight-bold text-primary">ملاحظات العائلة</h6>
                            <button class="btn btn-sm btn-primary" data-bs-toggle="modal" data-bs-target="#addNoteModal">
                                إضافة ملاحظة
                            </button>
                        </div>
                        <div class="card-body">
                            <div class="chat-container" id="family-notes">
                                <!-- سيتم ملء المحتوى ديناميكيًا -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- أفراد العائلة -->
                <div class="col-lg-6 mb-4">
                    <div class="card shadow h-100">
                        <div class="card-header py-3 d-flex justify-content-between align-items-center">
                            <h6 class="m-0 font-weight-bold text-primary">أفراد العائلة</h6>
                            <div>
                                <button class="btn btn-sm btn-primary me-2" data-bs-toggle="modal" data-bs-target="#addMemberModal">
                                    <i class="fas fa-plus"></i>
                                </button>
                                <a href="members.html" class="btn btn-sm btn-primary">إدارة</a>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="row text-center" id="family-members">
                                <!-- سيتم ملء المحتوى ديناميكيًا -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- نموذج إضافة ملاحظة -->
    <div class="modal fade" id="addNoteModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">إضافة ملاحظة جديدة</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="noteForm">
                        <input type="hidden" id="noteId">
                        <div class="mb-3">
                            <label class="form-label">نص الملاحظة</label>
                            <textarea class="form-control" rows="3" id="noteText" required></textarea>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">الأولوية</label>
                            <select class="form-select" id="notePriority">
                                <option value="normal" selected>عادية</option>
                                <option value="important">مهمة</option>
                                <option value="urgent">عاجلة</option>
                            </select>
                        </div>
                        <div class="mb-3 form-check">
                            <input type="checkbox" class="form-check-input" id="notifyAll">
                            <label class="form-check-label" for="notifyAll">إشعار الجميع بهذه الملاحظة</label>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">إلغاء</button>
                    <button type="button" class="btn btn-danger" id="deleteNote" style="display: none;">حذف</button>
                    <button type="button" class="btn btn-primary" id="saveNote">إضافة الملاحظة</button>
                </div>
            </div>
        </div>
    </div>

    <!-- نموذج إضافة حدث -->
    <div class="modal fade" id="addEventModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">إضافة حدث جديد</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="eventForm">
                        <input type="hidden" id="eventId">
                        <div class="mb-3">
                            <label class="form-label">عنوان الحدث</label>
                            <input type="text" class="form-control" id="eventTitle" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">التاريخ</label>
                            <input type="date" class="form-control" id="eventDate" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">الوقت</label>
                            <input type="time" class="form-control" id="eventTime" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">المكان</label>
                            <input type="text" class="form-control" id="eventLocation" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">الوصف</label>
                            <textarea class="form-control" rows="3" id="eventDescription"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">إلغاء</button>
                    <button type="button" class="btn btn-danger" id="deleteEvent" style="display: none;">حذف</button>
                    <button type="button" class="btn btn-primary" id="saveEvent">إضافة الحدث</button>
                </div>
            </div>
        </div>
    </div>

    <!-- نموذج إضافة مصروف -->
    <div class="modal fade" id="addExpenseModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">إضافة مصروف جديد</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="expenseForm">
                        <input type="hidden" id="expenseId">
                        <div class="mb-3">
                            <label class="form-label">الفئة</label>
                            <select class="form-select" id="expenseCategory" required>
                                <option value="">اختر الفئة</option>
                                <option value="البقالة">البقالة</option>
                                <option value="فواتير">فواتير</option>
                                <option value="تعليم">تعليم</option>
                                <option value="صحة">صحة</option>
                                <option value="ترفيه">ترفيه</option>
                                <option value="أخرى">أخرى</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">المبلغ (ريال)</label>
                            <input type="number" class="form-control" id="expenseAmount" required min="1">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">التاريخ</label>
                            <input type="date" class="form-control" id="expenseDate" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">الوصف</label>
                            <textarea class="form-control" rows="3" id="expenseDescription"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">إلغاء</button>
                    <button type="button" class="btn btn-danger" id="deleteExpense" style="display: none;">حذف</button>
                    <button type="button" class="btn btn-primary" id="saveExpense">إضافة المصروف</button>
                </div>
            </div>
        </div>
    </div>

    <!-- نموذج إضافة فرد -->
    <div class="modal fade" id="addMemberModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">إضافة فرد جديد</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="memberForm">
                        <input type="hidden" id="memberId">
                        <div class="mb-3">
                            <label class="form-label">الاسم</label>
                            <input type="text" class="form-control" id="memberName" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">الدور</label>
                            <input type="text" class="form-control" id="memberRole" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">صورة (رابط)</label>
                            <input type="url" class="form-control" id="memberImage">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">إلغاء</button>
                    <button type="button" class="btn btn-danger" id="deleteMember" style="display: none;">حذف</button>
                    <button type="button" class="btn btn-primary" id="saveMember">إضافة الفرد</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // بيانات التخزين المحلي
        let familyData = JSON.parse(localStorage.getItem('familyData')) || {
            events: [
                { id: 1, title: 'حفل عيد ميلاد أحمد', date: '2023-11-05', time: '17:00', location: 'منزلنا', description: '' },
                { id: 2, title: 'موعد طبيب سارة', date: '2023-11-06', time: '10:00', location: 'مستشفى المدينة', description: '' },
                { id: 3, title: 'اجتماع أولياء الأمور', date: '2023-11-10', time: '15:00', location: 'مدرسة النخيل', description: '' }
            ],
            expenses: [
                { id: 1, category: 'البقالة', amount: 320, date: '2023-10-20', description: '' },
                { id: 2, category: 'فواتير الكهرباء', amount: 240, date: '2023-10-18', description: '' },
                { id: 3, category: 'مصاريف الدراسة', amount: 450, date: '2023-10-15', description: '' }
            ],
            notes: [
                { id: 1, author: 'الأب', content: 'لا تنسوا موعد الطبيب غداً الساعة 10 صباحاً', time: 'منذ ساعتين', priority: 'normal' },
                { id: 2, author: 'الأم', content: 'يجب شراء مستلزمات الدراسة للأطفال', time: 'منذ 5 ساعات', priority: 'important' },
                { id: 3, author: 'أحمد', content: 'أحتاج مساعدة في مشروع العلوم يوم السبت', time: 'منذ يوم', priority: 'normal' }
            ],
            members: [
                { id: 1, name: 'الأب', role: 'مدير العائلة', image: 'https://ui-avatars.com/api/?name=الأب&background=4e73df&color=fff' },
                { id: 2, name: 'الأم', role: 'إدارة المنزل', image: 'https://ui-avatars.com/api/?name=الأم&background=6f42c1&color=fff' },
                { id: 3, name: 'أحمد', role: 'الابن', image: 'https://ui-avatars.com/api/?name=أحمد&background=1cc88a&color=fff' },
                { id: 4, name: 'سارة', role: 'الابنة', image: 'https://ui-avatars.com/api/?name=سارة&background=e74a3b&color=fff' },
                { id: 5, name: 'فاطمة', role: 'الابنة', image: 'https://ui-avatars.com/api/?name=فاطمة&background=f6c23e&color=fff' }
            ]
        };

        // دالة لحفظ البيانات في التخزين المحلي
        function saveData() {
            localStorage.setItem('familyData', JSON.stringify(familyData));
            updateDashboard();
        }

        // دالة لتنسيق التاريخ
        function formatDate(dateString) {
            const date = new Date(dateString);
            const today = new Date();
            const tomorrow = new Date(today);
            tomorrow.setDate(tomorrow.getDate() + 1);
            
            if (date.toDateString() === today.toDateString()) {
                return 'اليوم';
            } else if (date.toDateString() === tomorrow.toDateString()) {
                return 'غداً';
            } else {
                const diffTime = Math.abs(date - today);
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                
                if (diffDays < 7) {
                    return `بعد ${diffDays} أيام`;
                } else if (diffDays < 30) {
                    const weeks = Math.ceil(diffDays / 7);
                    return `بعد ${weeks} أسابيع`;
                } else {
                    return date.toLocaleDateString('ar-EG');
                }
            }
        }

        // دالة لتحديث لوحة التحكم
        function updateDashboard() {
            // تحديث الإحصائيات
            document.getElementById('events-count').textContent = `${familyData.events.length} أحداث`;
            document.getElementById('notes-count').textContent = `${familyData.notes.length} ملاحظة`;
            document.getElementById('members-count').textContent = `${familyData.members.length} أفراد`;
            
            // حساب إجمالي المصروفات
            const totalExpenses = familyData.expenses.reduce((total, expense) => total + expense.amount, 0);
            document.getElementById('expenses-total').textContent = `${totalExpenses.toLocaleString()} ريال`;
            
            // تحديث الأحداث القادمة
            const eventsContainer = document.getElementById('upcoming-events');
            eventsContainer.innerHTML = '';
            
            // ترتيب الأحداث حسب التاريخ
            const sortedEvents = [...familyData.events].sort((a, b) => new Date(a.date) - new Date(b.date));
            
            sortedEvents.slice(0, 3).forEach(event => {
                const formattedDate = formatDate(event.date);
                eventsContainer.innerHTML += `
                    <div class="list-group-item list-group-item-action family-event d-flex justify-content-between align-items-center">
                        <div class="flex-grow-1">
                            <div class="d-flex w-100 justify-content-between">
                                <h6 class="mb-1">${event.title}</h6>
                                <small>${formattedDate}</small>
                            </div>
                            <p class="mb-1">الوقت: ${event.time}</p>
                            <small>المكان: ${event.location}</small>
                        </div>
                        <div class="action-buttons">
                            <button class="btn btn-sm btn-outline-primary btn-icon edit-event" data-id="${event.id}">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-sm btn-outline-danger btn-icon delete-event" data-id="${event.id}">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                `;
            });
            
            // إضافة مستمعي الأحداث لأزرار التعديل والحذف
            document.querySelectorAll('.edit-event').forEach(button => {
                button.addEventListener('click', (e) => {
                    const eventId = parseInt(e.currentTarget.getAttribute('data-id'));
                    editEvent(eventId);
                });
            });
            
            document.querySelectorAll('.delete-event').forEach(button => {
                button.addEventListener('click', (e) => {
                    const eventId = parseInt(e.currentTarget.getAttribute('data-id'));
                    deleteEvent(eventId);
                });
            });
            
            // تحديث المصروفات
            const expensesContainer = document.getElementById('expenses-list');
            expensesContainer.innerHTML = '';
            
            // ترتيب المصروفات حسب التاريخ
            const sortedExpenses = [...familyData.expenses].sort((a, b) => new Date(b.date) - new Date(a.date));
            
            sortedExpenses.slice(0, 3).forEach(expense => {
                const expenseDate = new Date(expense.date);
                const formattedDate = expenseDate.toLocaleDateString('ar-EG');
                
                expensesContainer.innerHTML += `
                    <div class="expense-item d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="mb-0">${expense.category}</h6>
                            <small class="text-muted">${formattedDate}</small>
                        </div>
                        <div class="d-flex align-items-center">
                            <span class="text-danger me-2">- ${expense.amount.toLocaleString()} ريال</span>
                            <div class="action-buttons">
                                <button class="btn btn-sm btn-outline-primary btn-icon edit-expense" data-id="${expense.id}">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-sm btn-outline-danger btn-icon delete-expense" data-id="${expense.id}">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            // إضافة مستمعي الأحداث لأزرار التعديل والحذف
            document.querySelectorAll('.edit-expense').forEach(button => {
                button.addEventListener('click', (e) => {
                    const expenseId = parseInt(e.currentTarget.getAttribute('data-id'));
                    editExpense(expenseId);
                });
            });
            
            document.querySelectorAll('.delete-expense').forEach(button => {
                button.addEventListener('click', (e) => {
                    const expenseId = parseInt(e.currentTarget.getAttribute('data-id'));
                    deleteExpense(expenseId);
                });
            });
            
            // تحديث الملاحظات
            const notesContainer = document.getElementById('family-notes');
            notesContainer.innerHTML = '';
            
            familyData.notes.slice(0, 3).forEach(note => {
                notesContainer.innerHTML += `
                    <div class="d-flex mb-4">
                        <img src="https://ui-avatars.com/api/?name=${note.author}&background=4e73df&color=fff" class="family-img me-3">
                        <div class="flex-grow-1 position-relative">
                            <div class="bg-light p-3 rounded">
                                <div class="d-flex justify-content-between">
                                    <h6 class="mb-1">${note.author}</h6>
                                    <div class="action-buttons">
                                        <button class="btn btn-sm btn-outline-primary btn-icon edit-note" data-id="${note.id}">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button class="btn btn-sm btn-outline-danger btn-icon delete-note" data-id="${note.id}">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </div>
                                </div>
                                <p class="mb-0">${note.content}</p>
                                <small class="text-muted">${note.time}</small>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            // إضافة مستمعي الأحداث لأزرار التعديل والحذف
            document.querySelectorAll('.edit-note').forEach(button => {
                button.addEventListener('click', (e) => {
                    const noteId = parseInt(e.currentTarget.getAttribute('data-id'));
                    editNote(noteId);
                });
            });
            
            document.querySelectorAll('.delete-note').forEach(button => {
                button.addEventListener('click', (e) => {
                    const noteId = parseInt(e.currentTarget.getAttribute('data-id'));
                    deleteNote(noteId);
                });
            });
            
            // تحديث أفراد العائلة
            const membersContainer = document.getElementById('family-members');
            membersContainer.innerHTML = '';
            
            familyData.members.forEach(member => {
                membersContainer.innerHTML += `
                    <div class="col-4 mb-4 position-relative">
                        <div class="action-buttons position-absolute top-0 end-0 mt-2 me-2">
                            <button class="btn btn-sm btn-outline-primary btn-icon edit-member" data-id="${member.id}">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-sm btn-outline-danger btn-icon delete-member" data-id="${member.id}">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                        <img src="${member.image}" class="family-img mb-2">
                        <h6>${member.name}</h6>
                        <small class="text-muted">${member.role}</small>
                    </div>
                `;
            });
            
            // إضافة مستمعي الأحداث لأزرار التعديل والحذف
            document.querySelectorAll('.edit-member').forEach(button => {
                button.addEventListener('click', (e) => {
                    const memberId = parseInt(e.currentTarget.getAttribute('data-id'));
                    editMember(memberId);
                });
            });
            
            document.querySelectorAll('.delete-member').forEach(button => {
                button.addEventListener('click', (e) => {
                    const memberId = parseInt(e.currentTarget.getAttribute('data-id'));
                    deleteMember(memberId);
                });
            });
        }

        // دالة تحرير حدث
        function editEvent(id) {
            const event = familyData.events.find(e => e.id === id);
            if (event) {
                document.getElementById('eventId').value = event.id;
                document.getElementById('eventTitle').value = event.title;
                document.getElementById('eventDate').value = event.date;
                document.getElementById('eventTime').value = event.time;
                document.getElementById('eventLocation').value = event.location;
                document.getElementById('eventDescription').value = event.description || '';
                
                document.getElementById('deleteEvent').style.display = 'inline-block';
                document.getElementById('saveEvent').textContent = 'تحديث الحدث';
                
                const modal = new bootstrap.Modal(document.getElementById('addEventModal'));
                modal.show();
            }
        }

        // دالة حذف حدث
        function deleteEvent(id) {
            if (confirm('هل أنت متأكد من حذف هذا الحدث؟')) {
                familyData.events = familyData.events.filter(e => e.id !== id);
                saveData();
            }
        }

        // دالة تحرير مصروف
        function editExpense(id) {
            const expense = familyData.expenses.find(e => e.id === id);
            if (expense) {
                document.getElementById('expenseId').value = expense.id;
                document.getElementById('expenseCategory').value = expense.category;
                document.getElementById('expenseAmount').value = expense.amount;
                document.getElementById('expenseDate').value = expense.date;
                document.getElementById('expenseDescription').value = expense.description || '';
                
                document.getElementById('deleteExpense').style.display = 'inline-block';
                document.getElementById('saveExpense').textContent = 'تحديث المصروف';
                
                const modal = new bootstrap.Modal(document.getElementById('addExpenseModal'));
                modal.show();
            }
        }

        // دالة حذف مصروف
        function deleteExpense(id) {
            if (confirm('هل أنت متأكد من حذف هذا المصروف؟')) {
                familyData.expenses = familyData.expenses.filter(e => e.id !== id);
                saveData();
            }
        }

        // دالة تحرير ملاحظة
        function editNote(id) {
            const note = familyData.notes.find(n => n.id === id);
            if (note) {
                document.getElementById('noteId').value = note.id;
                document.getElementById('noteText').value = note.content;
                document.getElementById('notePriority').value = note.priority;
                
                document.getElementById('deleteNote').style.display = 'inline-block';
                document.getElementById('saveNote').textContent = 'تحديث الملاحظة';
                
                const modal = new bootstrap.Modal(document.getElementById('addNoteModal'));
                modal.show();
            }
        }

        // دالة حذف ملاحظة
        function deleteNote(id) {
            if (confirm('هل أنت متأكد من حذف هذه الملاحظة؟')) {
                familyData.notes = familyData.notes.filter(n => n.id !== id);
                saveData();
            }
        }

        // دالة تحرير فرد
        function editMember(id) {
            const member = familyData.members.find(m => m.id === id);
            if (member) {
                document.getElementById('memberId').value = member.id;
                document.getElementById('memberName').value = member.name;
                document.getElementById('memberRole').value = member.role;
                document.getElementById('memberImage').value = member.image;
                
                document.getElementById('deleteMember').style.display = 'inline-block';
                document.getElementById('saveMember').textContent = 'تحديث الفرد';
                
                const modal = new bootstrap.Modal(document.getElementById('addMemberModal'));
                modal.show();
            }
        }

        // دالة حذف فرد
        function deleteMember(id) {
            if (confirm('هل أنت متأكد من حذف هذا الفرد؟')) {
                familyData.members = familyData.members.filter(m => m.id !== id);
                saveData();
            }
        }

        // إضافة/تحديث حدث
        document.getElementById('saveEvent').addEventListener('click', function() {
            const eventId = document.getElementById('eventId').value;
            const title = document.getElementById('eventTitle').value;
            const date = document.getElementById('eventDate').value;
            const time = document.getElementById('eventTime').value;
            const location = document.getElementById('eventLocation').value;
            const description = document.getElementById('eventDescription').value;
            
            if (title && date && time && location) {
                if (eventId) {
                    // تحديث حدث موجود
                    const index = familyData.events.findIndex(e => e.id === parseInt(eventId));
                    if (index !== -1) {
                        familyData.events[index] = {
                            ...familyData.events[index],
                            title,
                            date,
                            time,
                            location,
                            description
                        };
                    }
                } else {
                    // إضافة حدث جديد
                    const newEvent = {
                        id: familyData.events.length > 0 ? Math.max(...familyData.events.map(e => e.id)) + 1 : 1,
                        title,
                        date,
                        time,
                        location,
                        description
                    };
                    
                    familyData.events.push(newEvent);
                }
                
                saveData();
                
                // إغلاق النموذج
                const modal = bootstrap.Modal.getInstance(document.getElementById('addEventModal'));
                modal.hide();
                
                // إعادة تعيين النموذج
                document.getElementById('eventForm').reset();
                document.getElementById('eventId').value = '';
                document.getElementById('deleteEvent').style.display = 'none';
                document.getElementById('saveEvent').textContent = 'إضافة الحدث';
            } else {
                alert('يرجى ملء جميع الحقول المطلوبة');
            }
        });

        // إضافة/تحديث مصروف
        document.getElementById('saveExpense').addEventListener('click', function() {
            const expenseId = document.getElementById('expenseId').value;
            const category = document.getElementById('expenseCategory').value;
            const amount = parseFloat(document.getElementById('expenseAmount').value);
            const date = document.getElementById('expenseDate').value;
            const description = document.getElementById('expenseDescription').value;
            
            if (category && amount && date) {
                if (expenseId) {
                    // تحديث مصروف موجود
                    const index = familyData.expenses.findIndex(e => e.id === parseInt(expenseId));
                    if (index !== -1) {
                        familyData.expenses[index] = {
                            ...familyData.expenses[index],
                            category,
                            amount,
                            date,
                            description
                        };
                    }
                } else {
                    // إضافة مصروف جديد
                    const newExpense = {
                        id: familyData.expenses.length > 0 ? Math.max(...familyData.expenses.map(e => e.id)) + 1 : 1,
                        category,
                        amount,
                        date,
                        description
                    };
                    
                    familyData.expenses.push(newExpense);
                }
                
                saveData();
                
                // إغلاق النموذج
                const modal = bootstrap.Modal.getInstance(document.getElementById('addExpenseModal'));
                modal.hide();
                
                // إعادة تعيين النموذج
                document.getElementById('expenseForm').reset();
                document.getElementById('expenseId').value = '';
                document.getElementById('deleteExpense').style.display = 'none';
                document.getElementById('saveExpense').textContent = 'إضافة المصروف';
            } else {
                alert('يرجى ملء جميع الحقول المطلوبة');
            }
        });

        // إضافة/تحديث ملاحظة
        document.getElementById('saveNote').addEventListener('click', function() {
            const noteId = document.getElementById('noteId').value;
            const content = document.getElementById('noteText').value;
            const priority = document.getElementById('notePriority').value;
            const notifyAll = document.getElementById('notifyAll').checked;
            
            if (content) {
                if (noteId) {
                    // تحديث ملاحظة موجودة
                    const index = familyData.notes.findIndex(n => n.id === parseInt(noteId));
                    if (index !== -1) {
                        familyData.notes[index] = {
                            ...familyData.notes[index],
                            content,
                            priority
                        };
                    }
                } else {
                    // إضافة ملاحظة جديدة
                    const newNote = {
                        id: familyData.notes.length > 0 ? Math.max(...familyData.notes.map(n => n.id)) + 1 : 1,
                        author: 'الأب', // المستخدم الحالي
                        content,
                        time: 'الآن',
                        priority
                    };
                    
                    familyData.notes.unshift(newNote);
                }
                
                saveData();
                
                // إغلاق النموذج
                const modal = bootstrap.Modal.getInstance(document.getElementById('addNoteModal'));
                modal.hide();
                
                // إعادة تعيين النموذج
                document.getElementById('noteForm').reset();
                document.getElementById('noteId').value = '';
                document.getElementById('deleteNote').style.display = 'none';
                document.getElementById('saveNote').textContent = 'إضافة الملاحظة';
                
                if (notifyAll) {
                    alert('تم إشعار جميع أفراد العائلة بالملاحظة');
                }
            } else {
                alert('يرجى إدخال نص الملاحظة');
            }
        });

        // إضافة/تحديث فرد
        document.getElementById('saveMember').addEventListener('click', function() {
            const memberId = document.getElementById('memberId').value;
            const name = document.getElementById('memberName').value;
            const role = document.getElementById('memberRole').value;
            let image = document.getElementById('memberImage').value;
            
            if (!image) {
                image = `https://ui-avatars.com/api/?name=${name}&background=4e73df&color=fff`;
            }
            
            if (name && role) {
                if (memberId) {
                    // تحديث فرد موجود
                    const index = familyData.members.findIndex(m => m.id === parseInt(memberId));
                    if (index !== -1) {
                        familyData.members[index] = {
                            ...familyData.members[index],
                            name,
                            role,
                            image
                        };
                    }
                } else {
                    // إضافة فرد جديد
                    const newMember = {
                        id: familyData.members.length > 0 ? Math.max(...familyData.members.map(m => m.id)) + 1 : 1,
                        name,
                        role,
                        image
                    };
                    
                    familyData.members.push(newMember);
                }
                
                saveData();
                
                // إغلاق النموذج
                const modal = bootstrap.Modal.getInstance(document.getElementById('addMemberModal'));
                modal.hide();
                
                // إعادة تعيين النموذج
                document.getElementById('memberForm').reset();
                document.getElementById('memberId').value = '';
                document.getElementById('deleteMember').style.display = 'none';
                document.getElementById('saveMember').textContent = 'إضافة الفرد';
            } else {
                alert('يرجى ملء جميع الحقول المطلوبة');
            }
        });

        // حذف حدث
        document.getElementById('deleteEvent').addEventListener('click', function() {
            const eventId = document.getElementById('eventId').value;
            if (eventId) {
                deleteEvent(parseInt(eventId));
                const modal = bootstrap.Modal.getInstance(document.getElementById('addEventModal'));
                modal.hide();
            }
        });

        // حذف مصروف
        document.getElementById('deleteExpense').addEventListener('click', function() {
            const expenseId = document.getElementById('expenseId').value;
            if (expenseId) {
                deleteExpense(parseInt(expenseId));
                const modal = bootstrap.Modal.getInstance(document.getElementById('addExpenseModal'));
                modal.hide();
            }
        });

        // حذف ملاحظة
        document.getElementById('deleteNote').addEventListener('click', function() {
            const noteId = document.getElementById('noteId').value;
            if (noteId) {
                deleteNote(parseInt(noteId));
                const modal = bootstrap.Modal.getInstance(document.getElementById('addNoteModal'));
                modal.hide();
            }
        });

        // حذف فرد
        document.getElementById('deleteMember').addEventListener('click', function() {
            const memberId = document.getElementById('memberId').value;
            if (memberId) {
                deleteMember(parseInt(memberId));
                const modal = bootstrap.Modal.getInstance(document.getElementById('addMemberModal'));
                modal.hide();
            }
        });

        // إعادة تعيين النماذج عند إغلاقها
        document.querySelectorAll('.modal').forEach(modal => {
            modal.addEventListener('hidden.bs.modal', function () {
                const forms = this.querySelectorAll('form');
                forms.forEach(form => form.reset());
                
                const hiddenFields = this.querySelectorAll('input[type="hidden"]');
                hiddenFields.forEach(field => field.value = '');
                
                const deleteButtons = this.querySelectorAll('.btn-danger');
                deleteButtons.forEach(button => button.style.display = 'none');
                
                const saveButtons = this.querySelectorAll('.btn-primary');
                saveButtons.forEach(button => {
                    if (button.id === 'saveEvent') button.textContent = 'إضافة الحدث';
                    if (button.id === 'saveExpense') button.textContent = 'إضافة المصروف';
                    if (button.id === 'saveNote') button.textContent = 'إضافة الملاحظة';
                    if (button.id === 'saveMember') button.textContent = 'إضافة الفرد';
                });
            });
        });

        // تهيئة البيانات عند تحميل الصفحة
        document.addEventListener('DOMContentLoaded', function() {
            updateDashboard();
        });
    </script>
</body>
</html>
